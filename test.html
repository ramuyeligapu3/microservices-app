<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini Shopping Portal</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">üõçÔ∏è Mini Shopping Portal</h1>

    <div class="row g-4">
      <!-- Products -->
      <div class="col-md-6">
        <h3>Products</h3>
        <button id="loadProducts" class="btn btn-primary mb-2">Load Products</button>
        <ul id="productList" class="list-group"></ul>
      </div>

      <!-- User Info -->
      <div class="col-md-6">
        <h3>User Info</h3>
        <div class="mb-2">
          <label for="userId" class="form-label">User ID:</label>
          <input type="number" id="userId" class="form-control" placeholder="Enter user ID"/>
        </div>
        <button id="fetchUser" class="btn btn-primary mb-2">Fetch User</button>
        <div id="userInfo" class="border p-2 bg-white"></div>
      </div>
    </div>

    <!-- Orders -->
    <div class="mt-5">
      <h3>Create Order</h3>
      <form id="orderForm" class="row g-3">
        <div class="col-md-4">
          <label for="orderUserId" class="form-label">User ID</label>
          <input type="number" id="orderUserId" class="form-control" required />
        </div>
        <div class="col-md-4">
          <label for="orderProduct" class="form-label">Product Name</label>
          <input type="text" id="orderProduct" class="form-control" required />
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button type="submit" class="btn btn-success w-100">Submit Order</button>
        </div>
      </form>
      <div id="orderResult" class="mt-3 border p-2 bg-white"></div>
    </div>
  </div>

  <script>
    const loadProductsBtn = document.getElementById("loadProducts");
    const productList = document.getElementById("productList");
    const fetchUserBtn = document.getElementById("fetchUser");
    const userInfoDiv = document.getElementById("userInfo");
    const orderForm = document.getElementById("orderForm");
    const orderResultDiv = document.getElementById("orderResult");

    // Load Products
    loadProductsBtn.addEventListener("click", () => {
      productList.innerHTML = "<li class='list-group-item'>Loading...</li>";
      fetch("/api/products-service/products")
        .then(res => res.json())
        .then(data => {
          productList.innerHTML = "";
          if (Array.isArray(data) && data.length > 0) {
            data.forEach(p => {
              const li = document.createElement("li");
              li.className = "list-group-item";
              li.textContent = `${p.name} - $${p.price || 'N/A'}`;
              productList.appendChild(li);
            });
          } else {
            productList.innerHTML = "<li class='list-group-item'>No products found.</li>";
          }
        })
        .catch(err => {
          productList.innerHTML = `<li class='list-group-item text-danger'>Error: ${err}</li>`;
        });
    });

    // Fetch User Info
    fetchUserBtn.addEventListener("click", () => {
      const userId = document.getElementById("userId").value;
      if (!userId) {
        userInfoDiv.innerHTML = "<em>Please enter a User ID.</em>";
        return;
      }
      userInfoDiv.innerHTML = "Loading...";
      fetch(`/api/users-service/${userId}`)
        .then(res => res.json())
        .then(data => {
          userInfoDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        })
        .catch(err => {
          userInfoDiv.innerHTML = `<span class="text-danger">Error: ${err}</span>`;
        });
    });

    // Submit Order
    orderForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const userId = document.getElementById("orderUserId").value;
      const product = document.getElementById("orderProduct").value;
      const payload = { user_id: userId, item: product };

      orderResultDiv.innerHTML = "Submitting...";
      fetch("/api/orders-service/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
        .then(res => res.json())
        .then(data => {
          orderResultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        })
        .catch(err => {
          orderResultDiv.innerHTML = `<span class="text-danger">Error: ${err}</span>`;
        });
    });
  </script>
</body>
</html>
